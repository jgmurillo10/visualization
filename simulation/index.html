<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Force Tutorial</title>
  </head>
  <body>
    <h1>Force Tutorial</h1>
    <canvas id="network" width="500" height="500"></canvas>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript">
      var graph = {
        nodes: [
          {
            name: "john",
            age: 36
          },
          {
            name: "alejo",
            age: 23
          },
          {
            name: "juan",
            age: 20
          },
          {
            name: "stephany",
            age: 23
          },
          {
            name: "carlos",
            age: 50
          },
          {
            name: "arnulfo",
            age: 96
          }
        ],
        links: [
          {source: "john", target: "alejo"},
          {source: "john", target: "juan"},
          {source: "arnulfo", target: "carlos"},
          {source: "stephany", target: "juan"},
          {source: "alejo", target: "juan"},
          {source: "arnulfo", target: "john"}
        ]
      }
      var canvas = d3.select("#network"),
      //returns the html or dom element
          ctx = canvas.node().getContext("2d"),
          width = canvas.attr("width"),
          height = canvas.attr("height"),
          r = 3,
          simulation = d3.forceSimulation()
                         .force("x",d3.forceX(width/2))
                         .force("y",d3.forceY(height/2))
                         .force("collide", d3.forceCollide(r+1))
                         .force("charge", d3.forceManyBody(r+1)
                                            .strength(-400))
                        //avoid setting x and y attribute to source and target of the links
                         .force("link", d3.forceLink()
                                          .id(function (d) {
                                            return d.name;
                                          }))
                         .on("tick", update);
          // graph.nodes.forEach(d=> {
          //   d.x = Math.random() * width;
          //   d.y = Math.random() * height;
          //  });
      simulation.nodes(graph.nodes);
      simulation.force("link").links(graph.links);
      function update() {
        //clear the whole canvas
         ctx.clearRect(0,0, width, height);

         ctx.beginPath();
         graph.links.forEach(drawLink);
         ctx.stroke ();

         ctx.beginPath();
         graph.nodes.forEach(drawNode);
         ctx.fill();
      }
      function drawNode(d) {
        ctx.moveTo(d.x,d.y);
        ctx.arc(d.x,d.y, r,0,2*Math.PI)
      }
      function drawLink(d) {
        ctx.moveTo(d.source.x,d.source.y);
        ctx.lineTo(d.target.x,d.target.y);
      }
      update();
    </script>
  </body>
</html>
